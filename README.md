# 令牌管理系统 GUI版本

基于SQLite数据库的令牌余额查询和分类管理工具，提供直观的图形用户界面。

## 🌟 主要特性

- **图形化界面**: 直观易用的GUI界面，告别命令行
- **数据库存储**: 使用SQLite数据库存储令牌数据，支持大规模数据管理
- **实时状态**: 实时显示令牌状态和统计信息
- **多线程处理**: 支持多线程并发查询，提高处理效率
- **智能分类**: 自动分类令牌为有效、余额不足、充值余额、无效等状态
- **批量导入**: 支持从文件批量导入令牌
- **灵活导出**: 支持按状态筛选导出到文件或剪贴板
- **配置管理**: 图形化配置界面，支持自定义API、阈值等参数
- **数据清理**: 支持按状态清理令牌数据
- **历史记录**: 记录查询历史和导出记录

## 📦 下载说明

为了确保下载和使用的安全性，我们现在提供ZIP压缩包格式：

- **避免下载警告**: ZIP格式绕过浏览器安全警告
- **包含验证信息**: 每个压缩包都包含版本说明和验证脚本
- **简单易用**: 解压即可运行，无需额外配置

## 📁 项目结构

```
lookSiliconflow_gui/
├── main.py                     # 主启动文件
├── requirements.txt            # 依赖包列表
├── src/                        # 源代码目录
│   ├── __init__.py
│   ├── gui_main.py             # GUI主界面
│   ├── database_manager.py     # 数据库管理
│   ├── config_manager.py       # 配置管理
│   ├── token_query_service.py  # 令牌查询服务
│   ├── settings_dialog.py      # 设置对话框
│   ├── export_dialog.py        # 导出对话框
│   └── data_migration_tool.py  # 数据迁移工具
├── database/                   # 数据库目录
├── icons/                      # 图标文件目录
└── logs/                       # 日志文件目录
```

## 🚀 快速开始

### 方法一：下载使用（推荐）

#### 1. 下载对应平台的压缩包
- **Windows**: token-manager-windows-x64.zip
- **macOS**: token-manager-macos-x64.zip  
- **Linux**: token-manager-linux-x64.zip

#### 2. 解压使用
```bash
# Windows: 解压后双击运行程序
token-manager-windows-x64.exe

# macOS: 解压后在终端中运行
chmod +x token-manager-macos-x64
./token-manager-macos-x64

# Linux: 解压后在终端中运行
chmod +x token-manager-linux-x64
./token-manager-linux-x64
```

**注意**: 如果Windows提示安全警告，点击"更多信息"→"仍要运行"即可。

### 方法二：从源码运行

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 启动应用
python main.py
```

### 3. 基本使用

1. **导入令牌**:
   - 点击"浏览"选择包含令牌的文本文件
   - 或直接在文本框中粘贴令牌
   - 点击"导入文件"或"添加令牌"

2. **处理令牌**:
   - 点击"开始处理"开始查询令牌余额
   - 系统会自动分类令牌为不同状态
   - 可以实时查看处理进度

3. **查看结果**:
   - 在状态概览中查看各类令牌数量
   - 在令牌列表中查看详细的令牌信息
   - 通过状态筛选查看特定类型的令牌

4. **导出令牌**:
   - 点击"导出"按钮
   - 选择要导出的令牌状态
   - 选择导出到文件或剪贴板

## 🔧 配置说明

### API设置
- **API端点**: SiliconFlow API的URL
- **超时时间**: 请求超时时间（秒）

### 余额阈值
- **有效令牌阈值**: ≥此值的令牌被归类为有效
- **低余额阈值**: 低于有效阈值但≥此值的令牌被归类为余额不足

### 线程设置
- **启用多线程**: 是否启用多线程处理
- **最大线程数**: 同时处理的最大线程数
- **批处理大小**: 用于进度显示的批处理大小

### 界面设置
- **主题**: 界面主题设置
- **窗口大小**: 主窗口的尺寸
- **自动刷新**: 是否自动刷新数据
- **刷新间隔**: 自动刷新的间隔时间

## 🔌 API代理服务器

### 功能说明
- **密钥轮询**: 自动轮询使用多个API密钥，避免单个密钥限流
- **负载均衡**: 在可用密钥之间智能分配请求
- **故障恢复**: 自动检测密钥失效并从轮询池中移除
- **统计监控**: 实时监控代理服务器状态和性能

### 使用方法
1. 在GUI界面中点击"代理设置"配置代理参数
2. 点击"启动代理"启动代理服务器
3. 使用以下URL格式发送请求:
   ```
   http://localhost:8080/proxy/v1/chat/completions
   ```
4. 代理服务器会自动轮询使用数据库中的有效令牌

### 配置参数
- **端口**: 代理服务器监听端口（默认8080）
- **超时时间**: 请求上游API的超时时间（秒）
- **最大失败次数**: 密钥连续失败的最大次数，超过后会被暂时移出轮询池

## 📊 数据迁移

从旧系统迁移数据到新系统：

### 1. 自动迁移（推荐）

启动GUI应用后，系统会自动：
- 检测旧配置文件并迁移配置
- 检测旧令牌文件并导入数据
- 创建迁移批次记录

### 2. 手动迁移

如果需要手动迁移，可以运行：

```bash
cd src
python data_migration_tool.py
```

## 🗂️ 数据库结构

### 配置表 (config)
存储系统配置参数

### 令牌表 (tokens)
- `id`: 令牌ID
- `token_hash`: 令牌哈希值（唯一标识）
- `token_value`: 令牌值
- `status`: 令牌状态
- `total_balance`: 总余额
- `charge_balance`: 充值余额
- `created_at`: 创建时间
- `updated_at`: 更新时间
- `last_checked`: 最后检查时间

### 批次表 (batches)
记录处理批次信息

### 导出表 (exports)
记录导出历史

## 🔍 令牌状态说明

- **pending**: 待处理（新添加但未查询的令牌）
- **valid**: 有效（余额≥有效阈值）
- **low_balance**: 余额不足（余额≥低余额阈值但<有效阈值）
- **charge_balance**: 有充值余额（充值余额>0）
- **invalid**: 无效（无法查询或余额为None）

## 📝 输入文件格式

支持两种格式：

### 1. 每行一个令牌
```
token1
token2
token3
```

### 2. 每行多个令牌（逗号分隔）
```
token1,token2,token3
token4,token5
```


## 🛠️ 高级功能

### 1. 批处理模式

系统支持批量处理大量令牌：
- 自动分批处理，避免内存溢出
- 实时显示处理进度
- 支持暂停和继续

### 2. 数据清理

定期清理不需要的令牌：
- 按状态筛选清理
- 支持多选清理
- 清理前确认提示

### 3. 日志记录

详细记录所有操作：
- 系统操作日志
- 查询结果日志
- 导出记录日志

## 🔍 故障排除

### 1. 启动失败
- 检查Python版本（建议≥3.7）
- 确保安装了所有依赖包
- 检查数据库目录权限

### 2. 查询失败
- 检查网络连接
- 验证API端点配置
- 确认令牌格式正确

### 3. 数据库错误
- 检查数据库文件是否损坏
- 确保有足够磁盘空间
- 重启应用后重试

## ⚠️ 常见问题

### Windows安全警告
如果出现"Windows保护您的PC"提示，点击"更多信息"→"仍要运行"即可。

### 杀毒软件误报
如被杀毒软件误报，添加到白名单或暂时禁用实时保护。

### 文件损坏
如果文件无法运行，重新下载或从源码构建。

## 📞 技术支持

如果遇到问题，请：
1. 查看日志文件中的错误信息
2. 检查配置是否正确
3. 确认API服务是否正常

### 获取帮助
- **GitHub Issues**: 提交问题
- **源码**: 查看和验证源码

## 🔄 版本历史

### v2.1.0 
- 压缩包发布，避免下载安全警告
- 添加文件完整性验证功能

### v2.0.0 (GUI版本)
- 全新的图形用户界面
- SQLite数据库存储
- 多线程并发处理
- 完整的配置管理
- 数据导入导出功能
- 从旧系统平滑迁移

### v1.0.0 (命令行版本)
- 基础的命令行工具
- 文件存储方式
- 简单的去重和查询功能

## 📄 许可证

本项目仅供学习和研究使用。